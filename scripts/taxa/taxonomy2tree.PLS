#!/usr/bin/perl -w# $Id: taxonomy2tree.PLS,v 1.1 2006-07-29 03:42:03 bosborne Exp $=head1 NAMEtaxonomy2tree - Building a taxonomic tree based on the full lineages of a set of species names=head1 DESCRIPTIONtaxonomy2tree.PLS: --species Orangutan Gorilla Chimpanzee Humantaxonomy2tree.PLS: --species "Orangutan" "Gorilla" "Chimpanzee" "Homo Sapiens"This script requires that the bioperl-run pkg be also installed.Providing the nodes.dmp and names.dmp files from the NCBI Taxonomydump (see L<Bio::DB::Taxonomy::flatfile> for more info) is only necessaryon the first time running.  This will create the local indexes and maytake quite a long time.  However once created, these indexes willallow fast access for species to taxon id OR taxon id to species namelookups.=head1 AUTHOR - Gabriel ValienteEmail valiente@lsi.upc.edu=cutuse strict;use Bio::DB::Taxonomy;use Bio::TreeIO;use Getopt::Long;my @species;# the input to the script is an array of species namesGetOptions('s|species=s' => \@species);my $nodesfile = "nodes.dmp";my $namesfile = "names.dmp";my $db = new Bio::DB::Taxonomy(-source => 'flatfile',                               -directory => "./db/",                               -nodesfile => $nodesfile,                               -namesfile => $namesfile);my $root = new Bio::Tree::Node(-id => "root");my $tree = new Bio::Tree::Tree(-root => $root);# the full lineages of the species are merged into a treefor my $name (@species) {  my $ncbi_id = $db->get_taxonid($name);  if ($ncbi_id) {    my $node = $db->get_Taxonomy_Node(-taxonid => $ncbi_id);    my @lineage = get_lineage_nodes($node);    shift @lineage; # discard root    push @lineage, $node;    merge_path($root, \@lineage);  } else {    warn "no NCBI Taxonomy node for species ",$name,"\n";  }}# the tree is output in Newick formatmy $output = new Bio::TreeIO(-format => 'newick');$output->write_tree($tree);# the actual merging of full lineages is performed by a recursive methodsub merge_path {  my $root = shift;  my $path = shift;  my @path = @{$path};  if (@path) {    my $top = shift @path;    my @children = grep { $_->id eq $top->node_name } $root->each_Descendent;    if (@children) {      # $root has a $child with id eq $top name      my $child = shift @children;      merge_path($child,\@path);    } else {      # add $top and @path below $root      my $node = $root;      unshift @path, $top;      while (@path) {        my $top = shift @path;        # my $child = new Bio::Tree::Node(-id => $top->node_name);        my $name = $top->node_name;        my $child = new Bio::Tree::Node(-id => "$name");        $node->add_Descendent($child);        $node = $child;      }    }  }}# the full lineage of a species is recovered by traversing the taxonomysub get_lineage_nodes{  my $node = shift;  my @lineage;  while ($node->node_name ne "root") {    $node = $node->get_Parent_Node;    unshift @lineage, $node;  }  return @lineage;}1;